RELEASES_URL="https://api.github.com/repos/WildKernels/OnePlus_KernelSU_SUSFS/releases?per_page=2"
MODEL_RAW=$(getprop ro.product.model)
log "$STR_DEVICE_MODEL: '$MODEL_RAW'"
case "$MODEL_RAW" in
  PJA110) SEARCH_KEYWORD="OP-ACE-2-PRO_" ;;
  PHK110|PHK110YS) SEARCH_KEYWORD="OP-ACE-2_" ;;
  PKG110) SEARCH_KEYWORD="OP-ACE-5_" ;;
  CPH2661|RMX3852|RMX3851|CPH2663) SEARCH_KEYWORD="OP-NORD-4_" ;;
  PHN110|CPH2551|CPH2499) SEARCH_KEYWORD="OP-OPEN_" ;;
  OPD2404|OPD2403) SEARCH_KEYWORD="OP-PAD-2_" ;;
  NE2210|NE2211|NE2213|NE2215|NE2217) SEARCH_KEYWORD="OP10pro_" ;;
  RMX3709|CPH2413|CPH2415|CPH2417|CPH2419) SEARCH_KEYWORD="OP10t_" ;;
  CPH2487) SEARCH_KEYWORD="OP11r_" ;;
  PHB110|CPH2447|CPH2449|CPH2451) SEARCH_KEYWORD="OP11_" ;;
  CPH2585|CPH2609|CPH2611) SEARCH_KEYWORD="OP12r_" ;;
  CPH2573|CPH2581|RMX3800|CPH2583) SEARCH_KEYWORD="OP12_" ;;
  RMX5011|CPH2655|CPH2653|CPH2649) SEARCH_KEYWORD="OP13_" ;;
  CPH2645|CPH2647|CPH2691) SEARCH_KEYWORD="OP13r_" ;;
  CPH2723) SEARCH_KEYWORD="OP13S_" ;;
  CPH2621|PJF110) SEARCH_KEYWORD="OP-ACE-3V" ;;
  "Armor 25T Pro") SEARCH_KEYWORD="OP-ACE-3V" ;;
  *) IS_ONEPLUS="0" ;;
esac

log "$STR_SEARCHING_KERNEL_PREFIX '$SEARCH_KEYWORD' $STR_SEARCHING_KERNEL_SUFFIX"

log "$STR_KERNEL_VERSIONS_REPO_MESSAGE WildKernels/OnePlus_KernelSU_SUSFS"
$CURL -s "$RELEASES_URL" > "$TMPDIR/releases.json"

log "$STR_SEARCHING_KERNEL_PREFIX '$SEARCH_KEYWORD' $STR_SEARCHING_KERNEL_SUFFIX"
ARCHIVE_URL=$(grep -oE '"browser_download_url": *"[^"]*'"$SEARCH_KEYWORD"'[^"]*\.zip"' "$TMPDIR/releases.json" \
  | head -n 1 \
  | sed 's/.*"browser_download_url": *"\([^"]*\)".*/\1/')  
if [ -z "$ARCHIVE_URL" ]; then
  log "‚ùå $STR_SEARCHING_KERNEL_FAIL $SEARCH_KEYWORD"
  #exit 0
fi
